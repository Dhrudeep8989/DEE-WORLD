<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex Johnson | AI Assistant</title>
    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-950 text-gray-100 font-sans leading-relaxed">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-gray-950/80 backdrop-blur-sm shadow-lg border-b border-gray-800">
        <div class="container mx-auto max-w-7xl px-4 py-4 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-extrabold text-blue-400 hover:text-blue-300 transition-colors">Alex J.</a>
            <nav class="space-x-4 md:space-x-8 text-lg hidden sm:flex">
                <a href="about.html" class="hover:text-blue-400 transition-colors">About</a>
                <a href="projects.html" class="hover:text-blue-400 transition-colors">Projects</a>
                <a href="certifications.html" class="hover:text-blue-400 transition-colors">Certifications</a>
                <a href="ai-assistant.html" class="hover:text-blue-400 transition-colors">AI Assistant</a>
                <a href="contact.html" class="hover:text-blue-400 transition-colors">Contact</a>
            </nav>
            <button id="mobileMenuBtn" class="sm:hidden text-gray-400 hover:text-blue-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
        </div>
        <!-- Mobile Menu Overlay -->
        <div id="mobileMenu" class="fixed inset-0 bg-gray-950/95 backdrop-blur-lg z-50 flex-col items-center justify-center hidden">
            <button id="closeMenuBtn" class="absolute top-4 right-4 text-gray-400 hover:text-blue-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <nav class="flex flex-col space-y-8 text-2xl">
                <a href="about.html" class="hover:text-blue-400 transition-colors">About</a>
                <a href="projects.html" class="hover:text-blue-400 transition-colors">Projects</a>
                <a href="certifications.html" class="hover:text-blue-400 transition-colors">Certifications</a>
                <a href="ai-assistant.html" class="hover:text-blue-400 transition-colors">AI Assistant</a>
                <a href="contact.html" class="hover:text-blue-400 transition-colors">Contact</a>
            </nav>
        </div>
    </header>

    <main class="container mx-auto max-w-7xl px-4 py-8">

        <!-- AI Assistant Section -->
        <section id="ai-assistant" class="py-16 md:py-24">
            <h2 class="text-3xl font-bold text-center mb-12 text-blue-400">Meet My AI Assistant</h2>
            <div class="bg-gray-900 rounded-xl shadow-2xl overflow-hidden border border-gray-800 max-w-3xl mx-auto">
                <div id="chat-history" class="p-6 h-[400px] overflow-y-auto scrollbar-thin">
                    <div class="text-center text-gray-500 italic mt-16">
                        Ask me anything about Alex's projects or skills!
                    </div>
                </div>
                <form id="chat-form" class="p-6 border-t border-gray-800 flex gap-2">
                    <input
                        type="text"
                        id="user-input"
                        placeholder="Ask a question..."
                        class="flex-1 p-3 bg-gray-800 text-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                    <button
                        type="submit"
                        id="send-button"
                        class="bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        Send
                    </button>
                </form>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="text-center text-gray-500 py-6 border-t border-gray-800 mt-16">
        <p>&copy; 2024 Alex Johnson. All rights reserved.</p>
    </footer>

    <script>
        // AI assistant functionality is now dedicated to this page
        document.addEventListener('DOMContentLoaded', () => {
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            const closeMenuBtn = document.getElementById('closeMenuBtn');
            const menuLinks = mobileMenu.querySelectorAll('a');

            // Mobile menu logic
            if (mobileMenuBtn && mobileMenu && closeMenuBtn) {
                mobileMenuBtn.addEventListener('click', () => {
                    mobileMenu.classList.remove('hidden');
                    mobileMenu.classList.add('flex');
                });

                closeMenuBtn.addEventListener('click', () => {
                    mobileMenu.classList.add('hidden');
                    mobileMenu.classList.remove('flex');
                });

                menuLinks.forEach(link => {
                    link.addEventListener('click', () => {
                        mobileMenu.classList.add('hidden');
                        mobileMenu.classList.remove('flex');
                    });
                });
            }

            const chatForm = document.getElementById('chat-form');
            const userInput = document.getElementById('user-input');
            const chatHistoryDiv = document.getElementById('chat-history');
            const sendButton = document.getElementById('send-button');

            async function fetchAIResponse(prompt) {
                const personaPrompt = `
                    You are a friendly and helpful AI assistant for the portfolio of a professional named Alex.
                    Your purpose is to answer questions about Alex's skills, experience, and projects.
                    Use the following information to generate your responses:
                    - **Name:** Alex Johnson
                    - **Role:** Full-Stack Developer
                    - **Skills:** JavaScript, Python, React, Node.js, Express, MongoDB, Tailwind CSS, SQL, Git, AWS
                    - **About:** Alex is a passionate developer who loves building elegant, scalable web applications. Alex has 5 years of experience in the industry.
                    - **Projects:**
                      1. **Project Spark:** A collaborative real-time document editor. Built with React and Node.js.
                      2. **Data-Viz Dashboard:** An interactive data visualization tool for business analytics. Built with Python and D3.js.
                      3. **E-commerce Platform:** A full-featured e-commerce site with user authentication and payment processing. Built with MERN stack.
                    - **Tone:** Friendly, professional, and knowledgeable.
                    
                    Answer the user's question concisely based on the information provided. If a question is outside of these topics, politely redirect them to ask about Alex's professional background.
                    
                    User's question: "${prompt}"
                    `;

                const chatHistoryForApi = [{ role: "user", parts: [{ text: personaPrompt }] }];
                const payload = { contents: chatHistoryForApi };
                const apiKey = "";
                const apiUrl = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=" + apiKey;
                
                // Exponential backoff for API calls
                const maxRetries = 5;
                let currentRetry = 0;

                while (currentRetry < maxRetries) {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (response.ok) {
                            const result = await response.json();
                            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
                                return result.candidates[0].content.parts[0].text;
                            }
                        }
                        
                        // If response is not ok, throw to trigger a retry
                        throw new Error(`API error: ${response.statusText}`);

                    } catch (error) {
                        console.error('Failed to fetch from Gemini API:', error);
                        currentRetry++;
                        if (currentRetry < maxRetries) {
                            const delay = Math.pow(2, currentRetry) * 1000;
                            await new Promise(resolve => setTimeout(resolve, delay));
                        }
                    }
                }
                return "Sorry, I'm having trouble with that request right now. Please try again later.";
            }

            chatForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const userMessage = userInput.value.trim();
                if (userMessage === '') return;

                // Display user message
                const userMessageElement = document.createElement('div');
                userMessageElement.className = 'flex justify-end mb-4';
                userMessageElement.innerHTML = `<div class="p-3 rounded-lg max-w-sm bg-blue-600 text-white">${userMessage}</div>`;
                chatHistoryDiv.appendChild(userMessageElement);

                // Clear input and show loading indicator
                userInput.value = '';
                sendButton.disabled = true;
                const loadingIndicator = document.createElement('div');
                loadingIndicator.className = 'flex justify-start mb-4';
                loadingIndicator.innerHTML = `<div class="p-3 rounded-lg bg-gray-700 text-gray-200">
                    <div class="animate-pulse flex space-x-2">
                        <div class="h-2 w-2 bg-gray-400 rounded-full"></div>
                        <div class="h-2 w-2 bg-gray-400 rounded-full"></div>
                        <div class="h-2 w-2 bg-gray-400 rounded-full"></div>
                    </div>
                </div>`;
                chatHistoryDiv.appendChild(loadingIndicator);
                chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;

                // Fetch and display AI response
                const aiResponse = await fetchAIResponse(userMessage);

                // Remove loading indicator
                chatHistoryDiv.removeChild(loadingIndicator);

                const aiMessageElement = document.createElement('div');
                aiMessageElement.className = 'flex justify-start mb-4';
                aiMessageElement.innerHTML = `<div class="p-3 rounded-lg max-w-sm bg-gray-700 text-gray-200">${aiResponse}</div>`;
                chatHistoryDiv.appendChild(aiMessageElement);

                sendButton.disabled = false;
                chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
            });
        });
    </script>
</body>
</html>
